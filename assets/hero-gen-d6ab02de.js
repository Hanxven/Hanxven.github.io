(function(){"use strict";function $(e){if(e.length===0)return[[]];const t=[];for(let s=1;s<=e.length;s++){const n=e.slice(0,s);if(n.length>1&&n[0]==="0")continue;const o=$(e.slice(s));for(const l of o)t.push([n,...l])}return t}const h=new Set(["+","-","*","/","^"]);function m(e,t=1){if(!isNaN(e))return null;let s=[],n="";for(let o of e)if(o==="(")s.push("(");else if(o===")")if(s.length>0)s.pop();else return null;else h.has(o)&&s.length===0&&(n=o);return t===1&&s.length===0?n:null}function c(e){switch(e){case"+":case"-":return 1;case"*":case"/":return 2;case"^":return 3;default:return-1e3}}function M(e,t,s){switch(e){case"+":return s+t;case"-":return s-t;case"*":return s*t;case"/":return s/t;case"^":return Math.pow(s,t);default:throw new Error("Unknown operator: "+e)}}function k(e){const t=[],s=[];for(let n=0;n<e.length;n++){const o=e[n];if(o!==" ")if(isNaN(o))if(o==="(")s.push(o);else if(o===")"){for(;s[s.length-1]!=="(";){if(s.length===0)throw new Error("Mismatched parentheses");t.push(M(s.pop(),t.pop(),t.pop()))}s.pop()}else if(h.has(o)){for(;s.length&&c(o)<=c(s[s.length-1]);)t.push(M(s.pop(),t.pop(),t.pop()));s.push(o)}else throw new Error("Invalid character: "+o);else{let l=o;for(;n+1<e.length&&!isNaN(e[n+1]);)l+=e[++n];t.push(Number(l))}}for(;s.length;){if(t.length<2)throw new Error("Invalid expression");t.push(M(s.pop(),t.pop(),t.pop()))}if(t.length!==1)throw new Error("Invalid expression");return t[0]}const v=new Map;function N(e){if(!isNaN(e))return new Set([e]);if(v.has(e))return v.get(e);const t=new Set;for(let s=1;s<e.length-1;s++){const n=e[s];if(h.has(n)){const o=N(e.slice(0,s)),l=N(e.slice(s+1));for(const f of o)for(const r of l){t.add(`${f} ${n} ${r}`);const p=isNaN(f),d=isNaN(r);if(p){const u=m(f);if(u&&c(u)>=c(n))continue;t.add(`(${f}) ${n} ${r}`)}if(d){const u=m(r);if(u&&c(u)>=c(n))continue;t.add(`${f} ${n} (${r})`)}if(p&&d){const u=m(f),y=m(r);if(u&&c(u)>=c(n)||y&&c(y)>=c(n))continue;t.add(`(${f}) ${n} (${r})`)}}}}return v.set(e,t),t}function S(e){if(e.length===1)return e;let t=[];function s(n,o){if(o===e.length){t.push(n.join(""));return}for(const l of h.values())n.push(l),n.push(e[o]),s(n,o+1),n.pop(),n.pop()}return s([e[0]],1),t}function I(e){const t=[];for(let s=1;s<e.length;s++){const n=e.slice(0,s),o=e.slice(s);t.push([n,o])}return t}function O(e){h.clear(),e.forEach(t=>h.add(t))}function P(e,t,s){let n=4;if(Array.isArray(e)&&e.every(r=>typeof r=="number")&&e.length>1?n=0:typeof e=="string"&&e.length>1&&!isNaN(e)&&(t===void 0?n=1:typeof t=="number"?n=2:typeof t=="string"&&t.length>=1&&!isNaN(t)&&(n=3)),n===4)return console.warn("Warning: Invalid arguments, please check the arguments and try again"),[];const o=[];let l;n===0?l=[e.map(r=>r.toString())]:l=$(e).filter(r=>r.length>1);let f;typeof t=="string"&&(f=$(t));for(const r of l){let p;n===1?p=I(r):n===2?p=[[r,[t.toString()]]]:n===3?p=f.map(d=>[r,d]):p=[];for(const[d,u]of p){const y=S(d),x=S(u),E=new Map,g=new Map,L=y.reduce((i,a)=>{const w=N(a);return[...i,...w]},[]),b=x.reduce((i,a)=>{const w=N(a);return[...i,...w]},[]);for(const i of L){const a=k(i);E.has(a)?E.get(a).push(i):E.set(a,[i])}for(const i of b){const a=k(i);g.has(a)?g.get(a).push(i):g.set(a,[i])}for(const[i,a]of E)if(g.has(i)){const w=g.get(i);for(const j of a)for(const q of w)o.push(`${j} = ${q}`)}}}return o}self.addEventListener("message",e=>{if(O(e.data.operators),e.data.mode==="default"){self.postMessage({name:"start"});const t=P(e.data.value1);self.postMessage({name:"result",data:t})}else if(e.data.mode==="equals"){self.postMessage({name:"start"});const t=P(e.data.value1,e.data.value2);self.postMessage({name:"result",data:t})}})})();
