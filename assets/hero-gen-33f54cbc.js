(function(){"use strict";function $(e){if(e.length===0)return[[]];const t=[];for(let s=1;s<=e.length;s++){const n=e.slice(0,s);if(n.length>1&&n[0]==="0")continue;const o=$(e.slice(s));for(const a of o)t.push([n,...a])}return t}const h=new Set(["+","-","*","/","^"]);function m(e,t=1){if(!isNaN(e))return null;let s=[],n="";for(let o of e)if(o==="(")s.push("(");else if(o===")")if(s.length>0)s.pop();else return null;else h.has(o)&&s.length===0&&(n=o);return t===1&&s.length===0?n:null}function c(e){switch(e){case"+":case"-":return 1;case"*":case"/":return 2;case"^":return 3;default:return-1e3}}function M(e,t,s){switch(e){case"+":return s+t;case"-":return s-t;case"*":return s*t;case"/":return s/t;case"^":return Math.pow(s,t);default:throw new Error("Unknown operator: "+e)}}function k(e){const t=[],s=[];for(let n=0;n<e.length;n++){const o=e[n];if(o!==" ")if(isNaN(o))if(o==="(")s.push(o);else if(o===")"){for(;s[s.length-1]!=="(";){if(s.length===0)throw new Error("Mismatched parentheses");t.push(M(s.pop(),t.pop(),t.pop()))}s.pop()}else if(h.has(o)){for(;s.length&&c(o)<=c(s[s.length-1]);)t.push(M(s.pop(),t.pop(),t.pop()));s.push(o)}else throw new Error("Invalid character: "+o);else{let a=o;for(;n+1<e.length&&!isNaN(e[n+1]);)a+=e[++n];t.push(Number(a))}}for(;s.length;){if(t.length<2)throw new Error("Invalid expression");t.push(M(s.pop(),t.pop(),t.pop()))}if(t.length!==1)throw new Error("Invalid expression");return t[0]}const v=new Map;function y(e){if(!isNaN(e))return new Set([e]);if(v.has(e))return v.get(e);const t=new Set;for(let s=1;s<e.length-1;s++){const n=e[s];if(h.has(n)){const o=y(e.slice(0,s)),a=y(e.slice(s+1));for(const f of o)for(const r of a){t.add(`${f} ${n} ${r}`);const p=isNaN(f),g=isNaN(r);if(p){const u=m(f);if(u&&c(u)>=c(n))continue;t.add(`(${f}) ${n} ${r}`)}if(g){const u=m(r);if(u&&c(u)>=c(n))continue;t.add(`${f} ${n} (${r})`)}if(p&&g){const u=m(f),N=m(r);if(u&&c(u)>=c(n)||N&&c(N)>=c(n))continue;t.add(`(${f}) ${n} (${r})`)}}}}return v.set(e,t),t}function S(e){if(e.length===1)return e;let t=[];function s(n,o){if(o===e.length){t.push(n.join(""));return}for(const a of h.values())n.push(a),n.push(e[o]),s(n,o+1),n.pop(),n.pop()}return s([e[0]],1),t}function I(e){const t=[];for(let s=1;s<e.length;s++){const n=e.slice(0,s),o=e.slice(s);t.push([n,o])}return t}function x(e){h.clear(),e.forEach(t=>h.add(t))}function P(e,t,s){let n=4;if(Array.isArray(e)&&e.every(r=>typeof r=="number")&&e.length>1?n=0:typeof e=="string"&&e.length>1&&!isNaN(e)&&(t===void 0?n=1:typeof t=="number"?n=2:typeof t=="string"&&t.length>=1&&!isNaN(t)&&(n=3)),n===4)return console.warn("Warning: Invalid arguments, please check the arguments and try again"),[];((n===1||n===0)&&e.length>6||n===3&&e.length+t.length>6||n===2&&e.length>5)&&console.warn("Warning: Hero sequence is too long, may take a extremely long time to run");const o=[];let a;n===0?a=[e.map(r=>r.toString())]:a=$(e).filter(r=>r.length>1);let f;typeof t=="string"&&(f=$(t));for(const r of a){let p;n===1?p=I(r):n===2?p=[[r,[t.toString()]]]:n===3?p=f.map(g=>[r,g]):p=[];for(const[g,u]of p){const N=S(g),O=S(u),E=new Map,d=new Map,q=N.reduce((i,l)=>{const w=y(l);return[...i,...w]},[]),H=O.reduce((i,l)=>{const w=y(l);return[...i,...w]},[]);for(const i of q){const l=k(i);E.has(l)?E.get(l).push(i):E.set(l,[i])}for(const i of H){const l=k(i);d.has(l)?d.get(l).push(i):d.set(l,[i])}for(const[i,l]of E)if(d.has(i)){const w=d.get(i);for(const L of l)for(const W of w)o.push(`${L} = ${W}`)}}}return o}self.addEventListener("message",e=>{if(x(e.data.operators),e.data.mode==="default"){self.postMessage({name:"start"});const t=P(e.data.value1);self.postMessage({name:"result",data:t})}else if(e.data.mode==="equals"){self.postMessage({name:"start"});const t=P(e.data.value1,e.data.value2);self.postMessage({name:"result",data:t})}})})();
